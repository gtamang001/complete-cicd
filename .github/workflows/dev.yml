name: workflow yaml 
on: 
  push: 
    branches: 
      - feature 
      - develop
  workflow_dispatch: 

jobs: 
  get-version: 
    runs-on: ubuntu-latest
    outputs: 
      version: ${{steps.version.outputs.VERSION}}
    steps: 
    - name: checkout code 
      uses: actions/checkout@v2
      with: 
        fetch-depth: '0'
    - name: run get version
      id: version
      run: |
        version=$(git describe --tags | cut -d '-' -f 1)
        echo "::set-output name=VERSION::$version"
      
  maven-build: 
    needs: get-version
    runs-on: ubuntu-latest
    steps: 
    - name: run maven build 
      run: |
        echo "maven build and then archive"
        echo "Is this printing ${{needs.get-version.outputs.version}}"
  docker-build: 
    needs: get-version
    runs-on: ubuntu-latest
    steps:
    - name: run docker build 
      run: echo "Run docker build and push"
  deploy-dev: 
    needs: docker-build
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.ref, 'refs/heads/feature') }}
    environment: dev
    steps: 
    - name: Test in two steps below 
      run: |
        echo "maven build and then archive"
        echo "Is this printing ${{needs.get-version.outputs.version}}"

  deploy-uat: 
    needs: docker-build
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'refs/heads/develop' }}
    environment: uat 
    steps: 
    - name: run uat update yaml 
      run: echo "update uat yaml kustomize"
  create-release: 
    needs: docker-build 
    runs-on: ubuntu-latest
    if: ${{ github.ref == 'refs/heads/main' }}
    environment: prod
    steps: 
    - name: run the release 
      run: echo "createing release"

  deploy-prod: 
    needs: create-release
    runs-on: ubuntu-latest
    environment: prod 
    steps: 
    - name: update prod 
      run: echo "update prod yaml"
# test comment 
  

  